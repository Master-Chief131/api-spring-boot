<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Registro de Cliente - API CPTSOFT</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" href="images/logos/logo_icono.svg" type="image/svg+xml">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }
    
    .container {
      max-width: 800px;
      margin: 0 auto;
      background: white;
      border-radius: 20px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.1);
      overflow: hidden;
    }
    
    .header {
      background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
      color: white;
      padding: 30px;
      text-align: center;
    }
    
    .header h1 {
      font-size: 2.5em;
      margin-bottom: 10px;
    }
    
    .header p {
      font-size: 1.1em;
      opacity: 0.9;
    }
    
    .form-container {
      padding: 40px;
    }
    
    .step-indicator {
            display: flex;
            justify-content: center;
            margin-bottom: 40px;
            gap: 20px;
        }

        .step {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 20px;
            border-radius: 25px;
            background: #f5f5f5;
            color: #666;
            transition: all 0.3s ease;
        }

        .step.active {
            background: #4CAF50;
            color: white;
        }

        .step .number {
            background: white;
            color: #4CAF50;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 12px;
        }

        .step.active .number {
            background: #45a049;
            color: white;
        }

        .form-section {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .form-section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group.full-width {
            grid-column: 1 / -1;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        input, select, textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e1e1e1;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #4CAF50;
            box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.1);
        }

        .radio-group {
            display: flex;
            gap: 20px;
            margin-top: 10px;
        }

        .radio-option {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            padding: 10px 15px;
            border: 2px solid #e1e1e1;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .radio-option:hover {
            border-color: #4CAF50;
            background: #f8fff8;
        }

        .radio-option input[type="radio"] {
            width: auto;
            margin: 0;
        }

        .radio-option.selected {
            border-color: #4CAF50;
            background: #f8fff8;
        }

        .buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
            gap: 15px;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 120px;
        }

        .btn-primary {
            background: #4CAF50;
            color: white;
        }

        .btn-primary:hover {
            background: #45a049;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .contacto-section, .usuario-section {
            display: none;
            border: 2px solid #e1e1e1;
            border-radius: 10px;
            padding: 25px;
            margin-top: 20px;
            background: #f9f9f9;
        }

        .contacto-section.show, .usuario-section.show {
            display: block;
            animation: slideDown 0.5s ease;
        }

        @keyframes slideDown {
            from { opacity: 0; max-height: 0; }
            to { opacity: 1; max-height: 1000px; }
        }

        .section-title {
            font-size: 1.4rem;
            color: #4CAF50;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #4CAF50;
        }        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }

        .alert.success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }

        .alert.error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }

        .response-container {
            display: none;
            background: #f8f9fa;
            border: 2px solid #28a745;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }

        .response-container.show {
            display: block;
            animation: slideDown 0.5s ease;
        }

        .response-title {
            font-size: 1.3rem;
            color: #28a745;
            margin-bottom: 15px;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .response-json {
            background: #2d3748;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            overflow-x: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #4a5568;
        }

        .response-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .summary-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #28a745;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .summary-card h4 {
            margin: 0 0 8px 0;
            color: #2c3e50;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .summary-card p {
            margin: 0;
            font-size: 1.1rem;
            font-weight: bold;
            color: #28a745;
        }

        .copy-btn {
            background: #6c757d;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
            margin-left: 10px;
            transition: background 0.3s;
        }

        .copy-btn:hover {
            background: #5a6268;
        }

        .copy-btn.copied {
            background: #28a745;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #4CAF50;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .required {
            color: #e74c3c;
        }

        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 10px;
            }

            .form-container {
                padding: 20px;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            .buttons {
                flex-direction: column;
            }

            .step-indicator {
                flex-direction: column;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üè¢ Registro de Cliente</h1>
            <p>Complete el formulario para registrarse en nuestro portal</p>
        </div>

        <div class="form-container">
            <div class="step-indicator">
                <div class="step active" id="step1">
                    <div class="number">1</div>
                    <span>Datos B√°sicos</span>
                </div>
                <div class="step" id="step2">
                    <div class="number">2</div>
                    <span>Contacto</span>
                </div>
                <div class="step" id="step3">
                    <div class="number">3</div>
                    <span>Usuario</span>
                </div>
            </div>            <div class="alert" id="alert"></div>
            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>Registrando cliente...</p>
            </div>

            <!-- Contenedor para mostrar la respuesta del API -->
            <div class="response-container" id="responseContainer">
                <div class="response-title">
                    ‚úÖ Cliente Registrado Exitosamente
                    <button class="copy-btn" id="copyBtn" onclick="copyResponse()">üìã Copiar JSON</button>
                </div>
                
                <div class="response-summary" id="responseSummary">
                    <!-- Se llena din√°micamente con JavaScript -->
                </div>

                <h4 style="margin: 20px 0 10px 0; color: #2c3e50;">üìÑ Respuesta Completa del API:</h4>
                <div class="response-json" id="responseJson">
                    <!-- Se llena din√°micamente con JavaScript -->
                </div>
            </div>

            <form id="clienteForm">
                <!-- PASO 1: Datos B√°sicos del Cliente -->
                <div class="form-section active" id="section1">
                    <h2 class="section-title">üìã Informaci√≥n B√°sica del Cliente</h2>
                    
                    <div class="form-group">
                        <label for="tipoPersona">Tipo de Persona <span class="required">*</span></label>
                        <div class="radio-group">
                            <div class="radio-option" onclick="selectPersonType('N')">
                                <input type="radio" id="personaNatural" name="personaNj" value="N" required>
                                <label for="personaNatural">üë§ Persona Natural</label>
                            </div>
                            <div class="radio-option" onclick="selectPersonType('J')">
                                <input type="radio" id="personaJuridica" name="personaNj" value="J" required>
                                <label for="personaJuridica">üè¢ Persona Jur√≠dica</label>
                            </div>
                        </div>
                    </div>

                    <div class="form-grid">
                        <div class="form-group">
                            <label for="noCia">Compa√±√≠a <span class="required">*</span></label>
                            <select id="noCia" name="noCia" required>
                                <option value="">Seleccione...</option>
                                <option value="1">Productos Maribel Prueba</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="grupo">Grupo <span class="required">*</span></label>
                            <select id="grupo" name="grupo" required>
                                <option value="">Seleccione...</option>
                                <option value="1">Grupo 1</option>
                                <option value="2">Grupo 2</option>
                            </select>
                        </div>

                        <div class="form-group full-width">
                            <label for="nombre">Nombre/Raz√≥n Social <span class="required">*</span></label>
                            <input type="text" id="nombre" name="nombre" required 
                                   placeholder="Ej: Juan P√©rez / Empresa S.A.">
                        </div>

                        <div class="form-group">
                            <label for="rucCedula">RUC/C√©dula <span class="required">*</span></label>
                            <input type="text" id="rucCedula" name="rucCedula" required 
                                   placeholder="Ej: 8-123-456 / 155123456789001">
                        </div>

                        <div class="form-group">
                            <label for="telefono">Tel√©fono <span class="required">*</span></label>
                            <input type="tel" id="telefono" name="telefono" required 
                                   placeholder="Ej: 507-1234-5678">
                        </div>

                        <div class="form-group">
                            <label for="email1">Email <span class="required">*</span></label>
                            <input type="email" id="email1" name="email1" required 
                                   placeholder="ejemplo@email.com">
                        </div>

                        <div class="form-group full-width">
                            <label for="direccion">Direcci√≥n <span class="required">*</span></label>
                            <textarea id="direccion" name="direccion" rows="3" required 
                                      placeholder="Direcci√≥n completa del cliente"></textarea>
                        </div>

                        <div class="form-group">
                            <label for="noPais">Pa√≠s</label>
                            <select id="noPais" name="noPais">
                                <option value="1">Panam√°</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="noProvincia">Provincia</label>
                            <select id="noProvincia" name="noProvincia">
                                <option value="1">Panam√°</option>
                                <option value="2">Cocl√©</option>
                                <option value="3">Col√≥n</option>
                                <option value="8">Panam√° Oeste</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="noDistrito">Distrito</label>
                            <input type="number" id="noDistrito" name="noDistrito" value="1">
                        </div>

                        <div class="form-group">
                            <label for="noCorregimiento">Corregimiento</label>
                            <input type="number" id="noCorregimiento" name="noCorregimiento" value="1">
                        </div>
                    </div>
                </div>

                <!-- PASO 2: Informaci√≥n de Contacto -->
                <div class="form-section" id="section2">
                    <h2 class="section-title">üìû Informaci√≥n de Contacto</h2>
                    
                    <div id="contactoNatural" class="contacto-section">
                        <p><strong>Para personas naturales:</strong> Los datos del cliente ser√°n utilizados como contacto principal.</p>
                        
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="apellidoCont">Apellidos</label>
                                <input type="text" id="apellidoCont" name="apellidoCont" 
                                       placeholder="Apellidos del contacto">
                            </div>

                            <div class="form-group">
                                <label for="movil">M√≥vil</label>
                                <input type="tel" id="movil" name="movil" 
                                       placeholder="Ej: 507-6123-4567">
                            </div>

                            <div class="form-group">
                                <label for="indSexo">Sexo</label>
                                <select id="indSexo" name="indSexo">
                                    <option value="">Seleccione...</option>
                                    <option value="M">Masculino</option>
                                    <option value="F">Femenino</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="fechaNacimiento">Fecha de Nacimiento</label>
                                <input type="date" id="fechaNacimiento" name="fechaNacimiento">
                            </div>
                        </div>
                    </div>

                    <div id="contactoJuridico" class="contacto-section">
                        <p><strong>Para personas jur√≠dicas:</strong> Informaci√≥n del contacto principal de la empresa.</p>
                        
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="contactoNombre">Nombre del Contacto <span class="required">*</span></label>
                                <input type="text" id="contactoNombre" name="contactoNombre" 
                                       placeholder="Nombre del representante">
                            </div>

                            <div class="form-group">
                                <label for="contactoApellido">Apellidos del Contacto <span class="required">*</span></label>
                                <input type="text" id="contactoApellido" name="contactoApellido" 
                                       placeholder="Apellidos del representante">
                            </div>

                            <div class="form-group">
                                <label for="contactoCedula">C√©dula del Contacto</label>
                                <input type="text" id="contactoCedula" name="contactoCedula" 
                                       placeholder="Ej: 8-123-456">
                            </div>

                            <div class="form-group">
                                <label for="contactoCargo">Cargo</label>
                                <input type="number" id="contactoCargo" name="contactoCargo" 
                                       placeholder="Ej: 1">
                            </div>

                            <div class="form-group">
                                <label for="contactoTelefono">Tel√©fono del Contacto</label>
                                <input type="tel" id="contactoTelefono" name="contactoTelefono" 
                                       placeholder="Ej: 507-264-8802">
                            </div>

                            <div class="form-group">
                                <label for="contactoMovil">M√≥vil del Contacto</label>
                                <input type="tel" id="contactoMovil" name="contactoMovil" 
                                       placeholder="Ej: 507-6234-5678">
                            </div>

                            <div class="form-group">
                                <label for="contactoEmail">Email del Contacto</label>
                                <input type="email" id="contactoEmail" name="contactoEmail" 
                                       placeholder="contacto@empresa.com">
                            </div>

                            <div class="form-group">
                                <label for="contactoExtension">Extensi√≥n</label>
                                <input type="text" id="contactoExtension" name="contactoExtension" 
                                       placeholder="Ej: 101">
                            </div>

                            <div class="form-group">
                                <label for="contactoDepartamento">Departamento</label>
                                <input type="number" id="contactoDepartamento" name="contactoDepartamento" 
                                       placeholder="Ej: 1">
                            </div>

                            <div class="form-group">
                                <label for="contactoTelefonoOficina">Tel√©fono de Oficina</label>
                                <input type="tel" id="contactoTelefonoOficina" name="contactoTelefonoOficina" 
                                       placeholder="Ej: 507-264-8803">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- PASO 3: Informaci√≥n de Usuario -->
                <div class="form-section" id="section3">
                    <h2 class="section-title">üë§ Informaci√≥n de Usuario</h2>
                    
                    <div class="usuario-section show">
                        <p><strong>Configuraci√≥n del usuario para acceso al portal web.</strong></p>
                        
                        <div class="form-grid">                            <div class="form-group">
                                <label for="usuario">Usuario <span class="required">*</span></label>
                                <input type="text" id="usuario" name="usuario" required 
                                       placeholder="Se generar√° autom√°ticamente desde el email">
                            </div>

                            <div class="form-group">
                                <label for="clave">Contrase√±a <span class="required">*</span></label>
                                <input type="password" id="clave" name="clave" required 
                                       placeholder="Contrase√±a segura">
                            </div>

                            <div class="form-group">
                                <label for="nomUsuario">Nombre de Usuario <span class="required">*</span></label>
                                <input type="text" id="nomUsuario" name="nomUsuario" required 
                                       placeholder="Nombre">
                            </div>

                            <div class="form-group">
                                <label for="apeUsuario">Apellidos de Usuario</label>
                                <input type="text" id="apeUsuario" name="apeUsuario" 
                                       placeholder="Apellidos">
                            </div>

                            <div class="form-group">
                                <label for="emailUsuario">Email de Usuario</label>
                                <input type="email" id="emailUsuario" name="emailUsuario" 
                                       placeholder="usuario@email.com">
                            </div>

                            <div class="form-group">
                                <label for="montoAutoriza">Monto de Autorizaci√≥n</label>
                                <input type="number" id="montoAutoriza" name="montoAutoriza" 
                                       placeholder="0.00" step="0.01">
                            </div>
                        </div>

                        <!-- <h3 style="margin: 20px 0 15px 0; color: #4CAF50;">Permisos del Usuario</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="indVendedor" name="indVendedor" value="S">
                                    Es Vendedor
                                </label>
                            </div>

                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="creaCliente" name="creaCliente" value="S">
                                    Puede Crear Clientes
                                </label>
                            </div>

                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="autorizaDescuento" name="autorizaDescuento" value="S">
                                    Autoriza Descuentos
                                </label>
                            </div>

                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="autorizaCompra" name="autorizaCompra" value="S">
                                    Autoriza Compras
                                </label>
                            </div>

                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="verImagenesPortal" name="verImagenesPortal" value="S" checked>
                                    Ver Im√°genes en Portal
                                </label>
                            </div>

                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="verGraficasPortal" name="verGraficasPortal" value="S" checked>
                                    Ver Gr√°ficas en Portal
                                </label>
                            </div>

                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="indVerPreciosInventario" name="indVerPreciosInventario" value="S">
                                    Ver Precios de Inventario
                                </label>
                            </div>

                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="fcCambiaPrecio" name="fcCambiaPrecio" value="S">
                                    Cambiar Precios
                                </label>
                            </div>
                        </div> -->
                    </div>
                </div>

                <div class="buttons">
                    <button type="button" class="btn btn-secondary" id="prevBtn" onclick="previousStep()" style="display: none;">
                        ‚Üê Anterior
                    </button>
                    <button type="button" class="btn btn-primary" id="nextBtn" onclick="nextStep()">
                        Siguiente ‚Üí
                    </button>
                    <button type="submit" class="btn btn-primary" id="submitBtn" style="display: none;">
                        üöÄ Registrar Cliente
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        let currentStep = 1;
        const totalSteps = 3;        // Configuraci√≥n del formulario
        document.addEventListener('DOMContentLoaded', function() {
            // Configurar valores por defecto
            document.getElementById('noCia').value = '1';
            document.getElementById('grupo').value = '1';
            document.getElementById('noPais').value = '507';
            document.getElementById('noProvincia').value = '1';
            document.getElementById('noDistrito').value = '1';
            document.getElementById('noCorregimiento').value = '1';

            // Agregar listeners para actualizaci√≥n autom√°tica del usuario
            setupEmailListeners();
        });

        function setupEmailListeners() {
            // Listener para email b√°sico (persona natural)
            document.getElementById('email1').addEventListener('input', function() {
                updateUsuarioFromEmail();
            });

            // Listener para email del contacto (persona jur√≠dica)
            document.getElementById('contactoEmail').addEventListener('input', function() {
                updateUsuarioFromEmail();
            });
        }

        function updateUsuarioFromEmail() {
            const tipoPersona = document.querySelector('input[name="personaNj"]:checked')?.value;
            let emailToUse = '';

            if (tipoPersona === 'N') {
                // Para persona natural, usar email b√°sico
                emailToUse = document.getElementById('email1').value;
            } else if (tipoPersona === 'J') {
                // Para persona jur√≠dica, usar email del contacto
                emailToUse = document.getElementById('contactoEmail').value;
            }

            // Actualizar campo usuario si tiene valor
            if (emailToUse) {
                document.getElementById('usuario').value = emailToUse;
                
                // Tambi√©n actualizar el email del usuario si est√° vac√≠o o es diferente
                const emailUsuarioField = document.getElementById('emailUsuario');
                if (!emailUsuarioField.value || emailUsuarioField.value !== emailToUse) {
                    emailUsuarioField.value = emailToUse;
                }
            }
        }        function selectPersonType(type) {
            // Actualizar selecci√≥n visual
            document.querySelectorAll('.radio-option').forEach(option => {
                option.classList.remove('selected');
            });
            
            if (type === 'N') {
                document.getElementById('personaNatural').checked = true;
                document.querySelector('label[for="personaNatural"]').parentElement.classList.add('selected');
            } else {
                document.getElementById('personaJuridica').checked = true;
                document.querySelector('label[for="personaJuridica"]').parentElement.classList.add('selected');
            }

            // Mostrar/ocultar secciones de contacto
            updateContactSection();
            
            // Actualizar usuario desde email cuando cambie el tipo de persona
            setTimeout(updateUsuarioFromEmail, 100);
        }

        function updateContactSection() {
            const tipoPersona = document.querySelector('input[name="personaNj"]:checked')?.value;
            const contactoNatural = document.getElementById('contactoNatural');
            const contactoJuridico = document.getElementById('contactoJuridico');

            contactoNatural.classList.remove('show');
            contactoJuridico.classList.remove('show');

            if (tipoPersona === 'N') {
                contactoNatural.classList.add('show');
            } else if (tipoPersona === 'J') {
                contactoJuridico.classList.add('show');
            }
        }

        function nextStep() {
            if (validateCurrentStep()) {
                if (currentStep < totalSteps) {
                    currentStep++;
                    updateStepDisplay();
                }
            }
        }

        function previousStep() {
            if (currentStep > 1) {
                currentStep--;
                updateStepDisplay();
            }
        }

        function updateStepDisplay() {
            // Actualizar indicadores de paso
            for (let i = 1; i <= totalSteps; i++) {
                const step = document.getElementById(`step${i}`);
                const section = document.getElementById(`section${i}`);

                if (i === currentStep) {
                    step.classList.add('active');
                    section.classList.add('active');
                } else {
                    step.classList.remove('active');
                    section.classList.remove('active');
                }
            }

            // Actualizar botones
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            const submitBtn = document.getElementById('submitBtn');

            prevBtn.style.display = currentStep > 1 ? 'block' : 'none';
            nextBtn.style.display = currentStep < totalSteps ? 'block' : 'none';
            submitBtn.style.display = currentStep === totalSteps ? 'block' : 'none';

            // Actualizar informaci√≥n de contacto y usuario cuando sea necesario
            if (currentStep === 2) {
                updateContactSection();
                updateContactInfo();
            } else if (currentStep === 3) {
                updateUserInfo();
            }
        }

        function updateContactInfo() {
            const tipoPersona = document.querySelector('input[name="personaNj"]:checked')?.value;
            
            if (tipoPersona === 'N') {
                // Para persona natural, copiar datos del cliente
                const nombre = document.getElementById('nombre').value;
                const email = document.getElementById('email1').value;
                
                // Auto-completar campos si est√°n vac√≠os
                if (!document.getElementById('emailUsuario').value) {
                    document.getElementById('emailUsuario').value = email;
                }
            }
        }        function updateUserInfo() {
            const tipoPersona = document.querySelector('input[name="personaNj"]:checked')?.value;
            
            // Usar la nueva funci√≥n para actualizar usuario desde email
            updateUsuarioFromEmail();

            if (tipoPersona === 'N') {
                // Para persona natural
                const nombre = document.getElementById('nombre').value;
                const apellidos = document.getElementById('apellidoCont').value;
                
                if (!document.getElementById('nomUsuario').value) {
                    document.getElementById('nomUsuario').value = nombre.split(' ')[0];
                }
                if (!document.getElementById('apeUsuario').value && apellidos) {
                    document.getElementById('apeUsuario').value = apellidos;
                }
            } else {
                // Para persona jur√≠dica
                const contactoNombre = document.getElementById('contactoNombre').value;
                const contactoApellido = document.getElementById('contactoApellido').value;
                
                if (!document.getElementById('nomUsuario').value && contactoNombre) {
                    document.getElementById('nomUsuario').value = contactoNombre;
                }
                if (!document.getElementById('apeUsuario').value && contactoApellido) {
                    document.getElementById('apeUsuario').value = contactoApellido;
                }
            }
        }

        function validateCurrentStep() {
            const currentSection = document.getElementById(`section${currentStep}`);
            const requiredFields = currentSection.querySelectorAll('[required]');
            let isValid = true;

            requiredFields.forEach(field => {
                if (!field.value.trim()) {
                    field.style.borderColor = '#e74c3c';
                    isValid = false;
                } else {
                    field.style.borderColor = '#e1e1e1';
                }
            });

            // Validaciones espec√≠ficas por paso
            if (currentStep === 1) {
                const tipoPersona = document.querySelector('input[name="personaNj"]:checked');
                if (!tipoPersona) {
                    showAlert('Por favor seleccione el tipo de persona', 'error');
                    return false;
                }
            }

            if (currentStep === 2 && document.querySelector('input[name="personaNj"]:checked')?.value === 'J') {
                // Validar campos requeridos para persona jur√≠dica
                const contactoNombre = document.getElementById('contactoNombre');
                const contactoApellido = document.getElementById('contactoApellido');
                
                if (!contactoNombre.value.trim() || !contactoApellido.value.trim()) {
                    showAlert('Por favor complete la informaci√≥n del contacto principal', 'error');
                    return false;
                }
            }

            if (!isValid) {
                showAlert('Por favor complete todos los campos requeridos', 'error');
            }

            return isValid;
        }

        function showAlert(message, type) {
            const alert = document.getElementById('alert');
            alert.textContent = message;
            alert.className = `alert ${type}`;
            alert.style.display = 'block';
            
            setTimeout(() => {
                alert.style.display = 'none';
            }, 5000);
        }

        // Manejar env√≠o del formulario
        document.getElementById('clienteForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            if (!validateCurrentStep()) {
                return;
            }

            const loadingDiv = document.getElementById('loading');
            const submitBtn = document.getElementById('submitBtn');
            
            loadingDiv.style.display = 'block';
            submitBtn.disabled = true;

            try {
                const jsonData = buildJSONData();
                console.log('Enviando datos:', JSON.stringify(jsonData, null, 2));

                // const response = await fetch('/api/clientes/registro-portal', {
                const response = await fetch('http://localhost:8080/api/clientes/registro-portal', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(jsonData)
                });                const result = await response.json();
                
                console.log('Respuesta del servidor:', result);
                console.log('Status de la respuesta:', response.status);
                console.log('Headers de la respuesta:', [...response.headers.entries()]);
                
                if (result.success) {
                    showAlert(`¬°Cliente registrado exitosamente! C√≥digo: ${result.V_SECUENCIAL}`, 'success');
                    
                    // Mostrar la respuesta completa del API
                    showApiResponse(result);
                    
                    // Opcional: redireccionar o limpiar formulario
                    setTimeout(() => {
                        if (confirm('¬øDesea registrar otro cliente?')) {
                            location.reload();
                        }
                    }, 10000); // Aumentado el tiempo para poder ver la respuesta
                } else {
                    showAlert(`Error: ${result.mensaje}`, 'error');
                }
            } catch (error) {
                console.error('Error:', error);
                showAlert(`Error de conexi√≥n: ${error.message}`, 'error');
            } finally {
                loadingDiv.style.display = 'none';
                submitBtn.disabled = false;
            }
        });        function buildJSONData() {
            const formData = new FormData(document.getElementById('clienteForm'));
            const tipoPersona = document.querySelector('input[name="personaNj"]:checked').value;

            // Datos b√°sicos del cliente
            const clienteData = {
                id: {
                    noCia: parseInt(formData.get('noCia')),
                    grupo: formData.get('grupo')
                },
                nombre: formData.get('nombre'),
                personaNj: tipoPersona,
                rucCedula: formData.get('rucCedula'),
                telefono: formData.get('telefono'),
                email1: formData.get('email1'),
                direccion: formData.get('direccion'),
                noPais: parseInt(formData.get('noPais')) || 507,
                noProvincia: parseInt(formData.get('noProvincia')) || 1,
                noDistrito: parseInt(formData.get('noDistrito')) || 1,
                noCorregimiento: parseInt(formData.get('noCorregimiento')) || 1,
                accesoWeb: "S",
                usuarioCreacion: "PORTAL_ADMIN",
                moduloOrigen: "WEB"
            };

            // Datos espec√≠ficos seg√∫n tipo de persona
            if (tipoPersona === 'N') {
                // Persona Natural
                clienteData.apellidoCont = formData.get('apellidoCont');
                clienteData.movil = formData.get('movil');
                clienteData.indSexo = formData.get('indSexo');
                if (formData.get('fechaNacimiento')) {
                    clienteData.fechaNacimiento = formData.get('fechaNacimiento');
                }
            } else {
                // Persona Jur√≠dica
                clienteData.nombreCont = formData.get('contactoNombre');
                clienteData.apellidoCont = formData.get('contactoApellido');
                
                // Objeto contacto para persona jur√≠dica
                clienteData.contacto = {
                    nombre: formData.get('contactoNombre'),
                    apellido: formData.get('contactoApellido'),
                    cedula: formData.get('contactoCedula'),
                    cargo: formData.get('contactoCargo'),
                    telefono: formData.get('contactoTelefono'),
                    movil: formData.get('contactoMovil'),
                    email: formData.get('contactoEmail'),
                    extension: formData.get('contactoExtension'),
                    departamento: formData.get('contactoDepartamento'),
                    telefonoOficina: formData.get('contactoTelefonoOficina'),
                    usuarioCreacion: "PORTAL_ADMIN",
                    fechaCreacion: new Date().toISOString().split('T')[0]
                };
            }

            // Objeto usuario
            clienteData.usuario = {
                usuario: formData.get('usuario'),
                nomUsuario: formData.get('nomUsuario'),
                apeUsuario: formData.get('apeUsuario'),
                email: formData.get('emailUsuario') || formData.get('email1'),
                clave: formData.get('clave'),
                indActivo: "S",
                indCliente: "S",
                indVendedor: formData.get('indVendedor') ? "S" : "N",
                creaCliente: formData.get('creaCliente') ? "S" : "N",
                autorizaDescuento: formData.get('autorizaDescuento') ? "S" : "N",
                autorizaCompra: formData.get('autorizaCompra') ? "S" : "N",
                verImagenesPortal: formData.get('verImagenesPortal') ? "S" : "N",
                verGraficasPortal: formData.get('verGraficasPortal') ? "S" : "N",
                indVerPreciosInventario: formData.get('indVerPreciosInventario') ? "S" : "N",
                fcCambiaPrecio: formData.get('fcCambiaPrecio') ? "S" : "N",
                montoAutoriza: formData.get('montoAutoriza') || "0.00"
            };return clienteData;
        }        function showApiResponse(response) {
            const responseContainer = document.getElementById('responseContainer');
            const responseSummary = document.getElementById('responseSummary');
            const responseJson = document.getElementById('responseJson');
            
            // Crear resumen de la respuesta
            const summaryHtml = `
                <div class="summary-card">
                    <h4>üìã Cliente Creado</h4>
                    <p>ID: ${response.V_SECUENCIAL || 'N/A'}</p>
                </div>
                <div class="summary-card">
                    <h4>üë§ Contacto Creado</h4>
                    <p>${response.contacto_registrado?.nombre || 'N/A'} ${response.contacto_registrado?.apellido || ''}</p>
                </div>
                <div class="summary-card">
                    <h4>üîê Usuario Creado</h4>
                    <p>${response.usuario_registrado?.usuario || 'N/A'}</p>
                </div>
                <div class="summary-card">
                    <h4>üîó Email Usuario</h4>
                    <p>${response.usuario_registrado?.email || 'N/A'}</p>
                </div>
                <div class="summary-card">
                    <h4>üìä Estado</h4>
                    <p>${response.success ? 'Exitoso' : 'Error'}</p>
                </div>
                <div class="summary-card">
                    <h4>üïí Timestamp</h4>
                    <p>${new Date().toLocaleString()}</p>
                </div>
            `;
            
            responseSummary.innerHTML = summaryHtml;
            
            // Mostrar JSON formateado
            responseJson.textContent = JSON.stringify(response, null, 2);
            
            // Mostrar el contenedor
            responseContainer.classList.add('show');
            
            // Scroll hacia la respuesta
            setTimeout(() => {
                responseContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }, 100);
        }

        function copyResponse() {
            const responseJson = document.getElementById('responseJson');
            const copyBtn = document.getElementById('copyBtn');
            
            // Copiar al portapapeles
            navigator.clipboard.writeText(responseJson.textContent).then(() => {
                // Cambiar el bot√≥n temporalmente
                const originalText = copyBtn.innerHTML;
                copyBtn.innerHTML = '‚úÖ Copiado';
                copyBtn.classList.add('copied');
                
                setTimeout(() => {
                    copyBtn.innerHTML = originalText;
                    copyBtn.classList.remove('copied');
                }, 2000);
            }).catch(err => {
                console.error('Error al copiar:', err);
                alert('Error al copiar al portapapeles');
            });
        }
    </script>
</body>
</html>
